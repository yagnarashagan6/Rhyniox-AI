<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF--8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"
    />
    <title>Rhyniox AI</title>
    <link
      rel="apple-touch-icon"
      href="https://raw.githubusercontent.com/yagnarashagan6/Rhyniox-AI/main/Lottie-files/rhynoix.png"
    />
    <link
      rel="icon"
      href="https://raw.githubusercontent.com/yagnarashagan6/Rhyniox-AI/main/Lottie-files/rhynoix.png"
    />
    <style>
      body {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        background: linear-gradient(
          180deg,
          #0a0a1a 0%,
          #1a1a2e 30%,
          #000000 100%
        );
        color: white;
        height: 100vh;
        overflow: hidden;
        position: relative;
      }

      /* Background container */
      #background {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        z-index: 1;
      }

      /* Keyframes for animated day sky */
      @keyframes day-cycle {
        0% {
          background-position: 0% 0%;
        }
        50% {
          background-position: 0% 100%;
        }
        100% {
          background-position: 0% 0%;
        }
      }

      /* Morning sky styles with animated gradient */
      .morning-sky {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: linear-gradient(
          180deg,
          #0b3d91,
          /* Deep Blue (Pre-dawn) */ #ff7e5f,
          /* Sunrise Orange */ #fec471,
          /* Sunrise Yellow */ #87ceeb,
          /* Midday Sky Blue */ #fec471,
          /* Sunset Yellow */ #ff7e5f,
          /* Sunset Orange */ #0b3d91 /* Deep Blue (Dusk) */
        );
        background-size: 100% 400%;
        animation: day-cycle 120s linear infinite;
        pointer-events: none;
        z-index: 1;
      }

      /* Sun */
      .sun {
        position: absolute;
        top: 15%;
        left: 50%;
        transform: translateX(-50%);
        width: 120px;
        height: 120px;
        background: radial-gradient(circle, #ffd700, #ffa500, #ff8c00);
        border-radius: 50%;
        box-shadow: 0 0 60px rgba(255, 215, 0, 0.6),
          0 0 120px rgba(255, 215, 0, 0.3);
        animation: sun-glow 3s ease-in-out infinite;
      }

      @keyframes sun-glow {
        0%,
        100% {
          box-shadow: 0 0 50px rgba(255, 215, 0, 0.6),
            0 0 100px rgba(255, 215, 0, 0.3);
          transform: translateX(-50%) scale(1);
        }
        50% {
          box-shadow: 0 0 70px rgba(255, 215, 0, 0.8),
            0 0 140px rgba(255, 215, 0, 0.4);
          transform: translateX(-50%) scale(1.05);
        }
      }

      /* Morning clouds */
      .morning-cloud {
        position: absolute;
        background: rgba(255, 255, 255, 0.8);
        border-radius: 50px;
        opacity: 0.9;
        animation: morning-drift 25s linear infinite;
      }

      .morning-cloud::before,
      .morning-cloud::after {
        content: "";
        position: absolute;
        background: rgba(255, 255, 255, 0.8);
        border-radius: 50px;
      }

      .morning-cloud.morning-cloud1 {
        width: 120px;
        height: 40px;
        top: 15%;
        left: -150px;
      }

      .morning-cloud.morning-cloud1::before {
        width: 80px;
        height: 50px;
        top: -20px;
        left: 20px;
      }

      .morning-cloud.morning-cloud1::after {
        width: 90px;
        height: 45px;
        top: -15px;
        right: 20px;
      }

      .morning-cloud.morning-cloud2 {
        width: 140px;
        height: 50px;
        top: 35%;
        left: -170px;
        animation-delay: -12s;
        animation-duration: 30s;
      }

      .morning-cloud.morning-cloud2::before {
        width: 90px;
        height: 60px;
        top: -25px;
        left: 25px;
      }

      .morning-cloud.morning-cloud2::after {
        width: 100px;
        height: 55px;
        top: -20px;
        right: 25px;
      }

      .morning-cloud.morning-cloud3 {
        width: 100px;
        height: 35px;
        top: 55%;
        left: -120px;
        animation-delay: -20s;
        animation-duration: 35s;
      }

      .morning-cloud.morning-cloud3::before {
        width: 70px;
        height: 40px;
        top: -15px;
        left: 15px;
      }

      .morning-cloud.morning-cloud3::after {
        width: 75px;
        height: 38px;
        top: -12px;
        right: 15px;
      }

      @keyframes morning-drift {
        0% {
          transform: translateX(0);
        }
        100% {
          transform: translateX(calc(100vw + 200px));
        }
      }

      /* Night sky background */
      .night-sky {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        pointer-events: none;
        z-index: 1;
      }

      /* Moon */
      .moon {
        position: absolute;
        top: 15%;
        left: 50%;
        transform: translateX(-50%);
        width: 120px;
        height: 120px;
        background: radial-gradient(
          circle at 30% 30%,
          #ffffff,
          #f0f0f0,
          #e0e0e0
        );
        border-radius: 50%;
        box-shadow: 0 0 60px rgba(255, 255, 255, 0.4),
          0 0 120px rgba(255, 255, 255, 0.2);
        animation: moon-glow 4s ease-in-out infinite;
      }

      @keyframes moon-glow {
        0%,
        100% {
          box-shadow: 0 0 60px rgba(255, 255, 255, 0.4),
            0 0 120px rgba(255, 255, 255, 0.2);
          transform: translateX(-50%) scale(1);
        }
        50% {
          box-shadow: 0 0 80px rgba(255, 255, 255, 0.6),
            0 0 160px rgba(255, 255, 255, 0.3);
          transform: translateX(-50%) scale(1.05);
        }
      }

      /* Stars */
      .star {
        position: absolute;
        background: white;
        border-radius: 50%;
        animation: twinkle 3s ease-in-out infinite;
      }
      .star.small {
        width: 2px;
        height: 2px;
      }
      .star.medium {
        width: 3px;
        height: 3px;
      }
      .star.large {
        width: 4px;
        height: 4px;
      }
      @keyframes twinkle {
        0%,
        100% {
          opacity: 0.3;
          transform: scale(1);
        }
        50% {
          opacity: 1;
          transform: scale(1.2);
        }
      }

      /* Clouds */
      .cloud {
        position: absolute;
        background: rgba(255, 255, 255, 0.1);
        border-radius: 50px;
        opacity: 0.6;
        animation: drift 20s linear infinite;
      }

      .cloud::before,
      .cloud::after {
        content: "";
        position: absolute;
        background: rgba(255, 255, 255, 0.1);
        border-radius: 50px;
      }

      .cloud.cloud1 {
        width: 80px;
        height: 30px;
        top: 25%;
        left: -100px;
      }
      .cloud.cloud1::before {
        width: 50px;
        height: 40px;
        top: -15px;
        left: 10px;
      }
      .cloud.cloud1::after {
        width: 60px;
        height: 35px;
        top: -10px;
        right: 10px;
      }

      .cloud.cloud2 {
        width: 100px;
        height: 40px;
        top: 40%;
        left: -120px;
        animation-delay: -10s;
        animation-duration: 25s;
      }
      .cloud.cloud2::before {
        width: 60px;
        height: 50px;
        top: -20px;
        left: 15px;
      }
      .cloud.cloud2::after {
        width: 70px;
        height: 45px;
        top: -15px;
        right: 15px;
      }

      .cloud.cloud3 {
        width: 60px;
        height: 25px;
        top: 60%;
        left: -80px;
        animation-delay: -15s;
        animation-duration: 30s;
      }
      .cloud.cloud3::before {
        width: 40px;
        height: 30px;
        top: -10px;
        left: 8px;
      }
      .cloud.cloud3::after {
        width: 45px;
        height: 28px;
        top: -8px;
        right: 8px;
      }

      @keyframes drift {
        0% {
          transform: translateX(0);
        }
        100% {
          transform: translateX(calc(100vw + 200px));
        }
      }

      /* Top navigation */
      .nav-bar {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        height: 60px;
        background: rgba(0, 0, 0, 0.3);
        backdrop-filter: blur(10px);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 100;
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
      }

      /* Status indicator */
      .status-indicator {
        position: absolute;
        top: 10px;
        left: 10px;
        display: flex;
        align-items: center;
        gap: 8px;
        background: rgba(0, 0, 0, 0.5);
        backdrop-filter: blur(10px);
        padding: 8px 12px;
        border-radius: 20px;
        font-size: 12px;
        font-weight: 600;
        text-transform: uppercase;
        border: 1px solid rgba(255, 255, 255, 0.1);
        transition: all 0.3s ease;
        z-index: 101;
      }

      .status-dot {
        width: 8px;
        height: 8px;
        border-radius: 50%;
        animation: pulse 2s infinite;
        flex-shrink: 0;
      }

      .status-indicator.online {
        color: #10b981;
        border-color: rgba(16, 185, 129, 0.3);
        box-shadow: 0 0 10px rgba(16, 185, 129, 0.2);
      }

      .status-indicator.online .status-dot {
        background: #10b981;
        box-shadow: 0 0 8px rgba(16, 185, 129, 0.5);
      }

      .status-indicator.offline {
        color: #ef4444;
        border-color: rgba(239, 68, 68, 0.3);
        box-shadow: 0 0 10px rgba(239, 68, 68, 0.2);
      }

      .status-indicator.offline .status-dot {
        background: #ef4444;
        box-shadow: 0 0 8px rgba(239, 68, 68, 0.5);
      }

      .status-indicator.checking {
        color: #f59e0b;
        border-color: rgba(245, 158, 11, 0.3);
        box-shadow: 0 0 10px rgba(245, 158, 11, 0.2);
      }

      .status-indicator.checking .status-dot {
        background: #f59e0b;
        box-shadow: 0 0 8px rgba(245, 158, 11, 0.5);
        animation: pulse 1s infinite;
      }

      @keyframes pulse {
        0%,
        100% {
          opacity: 1;
          transform: scale(1);
        }
        50% {
          opacity: 0.5;
          transform: scale(0.8);
        }
      }

      .nav-title {
        font-size: 20px;
        font-weight: 600;
        background: linear-gradient(135deg, #60a5fa, #93c5fd, #dbeafe);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        flex: 1;
        text-align: center;
      }

      /* Main content area */
      .main-content {
        position: fixed;
        top: 60px;
        bottom: 260px; /* Increased bottom to make space for the mic */
        left: 0;
        right: 0;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        z-index: 10;
        padding: 0 20px;
      }

      /* Status display */
      .status-display {
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        z-index: 20;
        text-align: center;
        min-height: 60px;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
      }

      .status-text {
        font-family: "Arial", sans-serif;
        font-size: 24px;
        font-weight: bold;
        color: #ffffff;
        margin-bottom: 10px;
        text-shadow: 0 0 15px rgba(255, 255, 255, 0.8);
        max-width: 90vw;
        word-wrap: break-word;
        white-space: normal;
        overflow: hidden;
        display: -webkit-box;
        -webkit-line-clamp: 3;
        line-clamp: 3;
        -webkit-box-orient: vertical;
        word-spacing: 3px;
        transition: color 0.3s ease;
      }

      .day-mode .status-text {
        color: #000;
        text-shadow: 0 0 3px rgba(0, 0, 0, 0.2);
      }

      .night-mode .status-text {
        color: #f0f0f0;
        text-shadow: 0 0 5px rgba(255, 255, 255, 0.3);
      }

      .status-text.error-text {
        color: #ef4444; /* Red for errors */
        text-shadow: 0 0 10px rgba(239, 68, 68, 0.5);
      }

      .status-text.warning-text {
        color: #f59e0b; /* Orange for warnings */
        text-shadow: 0 0 10px rgba(245, 158, 11, 0.5);
      }

      .typing-dots {
        display: none;
        font-size: 24px;
        color: white;
        text-shadow: 0 0 15px rgba(255, 255, 255, 0.8);
        animation: star-pulse 1.5s infinite;
      }

      @keyframes star-pulse {
        0%,
        100% {
          opacity: 0.4;
          text-shadow: 0 0 10px rgba(255, 255, 255, 0.5);
        }
        50% {
          opacity: 1;
          text-shadow: 0 0 20px rgba(255, 255, 255, 1);
        }
      }

      /* Microphone button - CONSOLIDATED & RESPONSIVE */
      .mic-container {
        position: fixed;
        bottom: 10px;
        left: 50%;
        transform: translateX(-50%);
        z-index: 200;
      }

      .mic-button {
        width: 300px;
        height: 300px;
        border: none;
        background: transparent;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.3s ease;
        position: relative;
        z-index: 2;
        right: 20px;
      }

      .mic-button lottie-player {
        width: 100% !important;
        height: 100% !important;
        filter: drop-shadow(0 4px 20px rgba(96, 165, 250, 0.4));
      }
      .mic-button:hover {
        transform: scale(1.1);
      }

      .mic-button:hover lottie-player {
        filter: drop-shadow(0 6px 30px rgba(96, 165, 250, 0.6));
      }

      .mic-button.listening lottie-player {
        filter: drop-shadow(0 4px 20px rgba(16, 185, 129, 0.6));
        animation: listening-glow 2s infinite;
      }
      .mic-button.speaking lottie-player {
        filter: drop-shadow(0 4px 20px rgba(96, 165, 250, 0.8));
        animation: speaking-pulse 0.5s infinite;
      }

      .mic-button.live-mode-active {
        border-radius: 50%;
        border: 3px solid rgba(16, 185, 129, 0.5);
      }

      .mic-button.live-mode-active::before {
        content: "LIVE";
        position: absolute;
        top: -10px;
        left: 50%;
        transform: translateX(-50%);
        background: linear-gradient(135deg, #10b981, #059669);
        color: white;
        padding: 2px 8px;
        border-radius: 12px;
        font-size: 10px;
        font-weight: bold;
        animation: pulse-live 2s infinite;
      }

      @keyframes pulse-live {
        0%,
        100% {
          opacity: 0.8;
          transform: translateX(-50%) scale(1);
        }
        50% {
          opacity: 1;
          transform: translateX(-50%) scale(1.1);
        }
      }

      @keyframes listening-glow {
        0%,
        100% {
          filter: drop-shadow(0 4px 20px rgba(16, 185, 129, 0.6));
          transform: scale(1);
        }
        50% {
          filter: drop-shadow(0 8px 40px rgba(16, 185, 129, 0.9));
          transform: scale(1.05);
        }
      }

      @keyframes speaking-pulse {
        0%,
        100% {
          filter: drop-shadow(0 4px 20px rgba(96, 165, 250, 0.8));
          transform: scale(1);
        }
        50% {
          filter: drop-shadow(0 8px 40px rgba(96, 165, 250, 1));
          transform: scale(1.1);
        }
      }

      /* Bottom navigation */
      .bottom-nav {
        position: fixed;
        bottom: 0;
        left: 0;
        right: 0;
        height: 80px;
        background: rgba(0, 0, 0, 0.4);
        backdrop-filter: blur(10px);
        display: flex;
        align-items: center;
        justify-content: space-around;
        z-index: 100;
        border-top: 1px solid rgba(255, 255, 255, 0.1);
      }

      .nav-button {
        background: none;
        border: none;
        color: #60a5fa;
        font-size: 24px;
        cursor: pointer;
        padding: 10px;
        border-radius: 10px;
        transition: all 0.3s ease;
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 5px;
        width: 80px; /* Give buttons a fixed width for better spacing */
      }

      .nav-button:hover {
        background: rgba(96, 165, 250, 0.15);
        transform: translateY(-2px);
        box-shadow: 0 4px 20px rgba(96, 165, 250, 0.2);
      }

      .nav-button.active {
        color: #10b981; /* Green to indicate active state */
        background: rgba(16, 185, 129, 0.1);
      }

      .nav-button span {
        font-size: 12px;
        font-weight: 500;
      }

      /* Modal styles */
      .modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.8);
        z-index: 1000;
        backdrop-filter: blur(5px);
        align-items: center;
        justify-content: center;
      }

      .modal-content {
        position: relative;
        background: rgba(26, 26, 46, 0.85);
        backdrop-filter: blur(20px);
        border-radius: 20px;
        padding: 20px;
        width: 90%;
        max-width: 400px;
        max-height: 80vh; /* Changed to 80vh */
        display: flex; /* Flexbox for better internal layout */
        flex-direction: column;
        border: 1px solid rgba(96, 165, 250, 0.3);
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3),
          0 0 40px rgba(96, 165, 250, 0.1);
      }

      .modal-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
        padding-bottom: 10px;
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        flex-shrink: 0;
      }

      .modal-title {
        font-size: 20px;
        font-weight: 600;
        color: #60a5fa;
        text-shadow: 0 0 10px rgba(96, 165, 250, 0.5);
      }

      .close-button {
        background: none;
        border: none;
        color: #60a5fa;
        font-size: 24px;
        cursor: pointer;
        padding: 5px;
        border-radius: 5px;
      }

      .close-button:hover {
        background: rgba(96, 165, 250, 0.15);
        box-shadow: 0 0 15px rgba(96, 165, 250, 0.3);
      }

      /* Content inside modals that should scroll */
      #historyContent,
      #voiceList {
        overflow-y: auto;
        flex-grow: 1;
      }

      /* Voice Modal Styles */
      .voice-list {
        display: flex;
        flex-direction: column;
        gap: 10px;
      }
      .voice-item {
        background: rgba(255, 255, 255, 0.08);
        border: 1px solid transparent;
        border-left: 3px solid #60a5fa;
        padding: 15px;
        border-radius: 10px;
        cursor: pointer;
        transition: all 0.3s ease;
      }
      .voice-item:hover {
        background: rgba(96, 165, 250, 0.15);
        border-color: rgba(96, 165, 250, 0.5);
      }
      .voice-item.selected {
        background: rgba(96, 165, 250, 0.25);
        border-left: 3px solid #10b981; /* Green for selected */
        box-shadow: 0 0 15px rgba(16, 185, 129, 0.3);
      }
      .voice-item .voice-name {
        font-weight: 600;
        color: #dbeafe;
      }
      .voice-item .voice-lang {
        font-size: 12px;
        color: #93c5fd;
      }

      .history-item {
        background: rgba(255, 255, 255, 0.08);
        border-radius: 10px;
        padding: 15px;
        margin-bottom: 10px;
        border-left: 3px solid #60a5fa;
        box-shadow: 0 2px 10px rgba(96, 165, 250, 0.1);
      }

      .history-user {
        color: #60a5fa;
        font-weight: 600;
        margin-bottom: 5px;
        text-shadow: 0 0 8px rgba(96, 165, 250, 0.3);
      }

      .history-ai {
        color: #ccc;
        font-size: 14px;
      }

      .history-note {
        font-size: 12px;
        color: #93c5fd;
        text-align: center;
        margin-top: 15px;
        font-style: italic;
        flex-shrink: 0;
      }

      .history-controls {
        display: flex;
        gap: 10px;
        margin-bottom: 20px;
        flex-wrap: wrap;
        flex-shrink: 0;
      }

      .control-button {
        background: linear-gradient(135deg, #60a5fa, #3b82f6);
        border: none;
        color: white;
        padding: 8px 16px;
        border-radius: 20px;
        cursor: pointer;
        font-size: 14px;
        font-weight: 500;
        transition: all 0.3s ease;
        box-shadow: 0 2px 8px rgba(96, 165, 250, 0.2);
      }

      .control-button:hover {
        transform: translateY(-1px);
        box-shadow: 0 6px 20px rgba(96, 165, 250, 0.4);
      }

      .control-button.danger {
        background: linear-gradient(135deg, #ff4757, #ff3742);
      }

      .empty-history {
        text-align: center;
        color: #666;
        font-style: italic;
        padding: 40px 20px;
      }

      /* Responsive design */
      @media (max-width: 768px) {
        .mic-button {
          width: 250px;
          height: 250px;
        }
        .mic-button.live-mode-active::before {
          top: 5px;
        }
        body {
          overflow-x: hidden; /* Prevent horizontal scroll */
        }
        /* Ensure night sky elements are visible on mobile */
        .night-sky {
          z-index: 1 !important;
        }
        .star {
          z-index: 2;
        }
        .cloud {
          z-index: 3;
        }
        .moon {
          z-index: 4;
        }
      }

      @media (max-width: 480px) {
        .main-content {
          bottom: 140px; /* Move content up to make room for larger mic */
          padding: 0 10px;
        }
        .mic-button {
          width: 200px; /* Increased from 140px */
          height: 200px; /* Increased from 140px */
          right: 0; /* Remove right offset on mobile */
        }
        .mic-container {
          bottom: 50px; /* Moved up from 15px */
        }
        .nav-button {
          font-size: 18px;
          width: 65px;
          padding: 8px;
        }
        .nav-button span {
          font-size: 9px;
        }
        .modal-content {
          width: 95%;
          padding: 15px;
          max-height: 85vh;
        }
        .status-indicator {
          top: 17px;
          left: 5px;
          padding: 6px 10px;
          font-size: 10px;
        }
        .status-dot {
          width: 6px;
          height: 6px;
        }
        /* Hide tree animation on mobile */
        #treeContainer {
          display: none !important;
        }
        body {
          overflow: hidden; /* Prevent any scroll on mobile */
          position: fixed; /* Prevent page expansion */
          width: 100%;
          height: 100%;
        }
        .bottom-nav {
          height: 70px; /* Reduce bottom nav height on mobile */
        }
        /* Ensure proper background in night mode on mobile */
        #background {
          background: transparent;
        }
        .night-sky {
          background: linear-gradient(
            180deg,
            #0a0a1a 0%,
            #1a1a2e 30%,
            #000000 100%
          ) !important;
        }
        /* Ensure stars are visible and twinkling on mobile */
        .star {
          display: block !important;
          opacity: 1 !important;
          animation: twinkle 3s ease-in-out infinite !important;
        }
        /* Ensure clouds are visible and moving on mobile */
        .cloud {
          display: block !important;
          opacity: 0.6 !important;
        }
        /* Make moon more visible on mobile */
        .moon {
          width: 100px;
          height: 100px;
          top: 10%;
        }
        .nav-title {
          font-size: 22px !important;
          white-space: nowrap;
        }
        .status-text {
          font-size: 18px;
          word-spacing: 2px;
        }
      }

      /* Name Modal Styles */
      .name-modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.9);
        z-index: 2000;
        backdrop-filter: blur(10px);
        align-items: center;
        justify-content: center;
      }

      .name-modal-content {
        background: rgba(26, 26, 46, 0.95);
        backdrop-filter: blur(20px);
        border-radius: 20px;
        padding: 30px;
        width: 90%;
        max-width: 400px;
        border: 1px solid rgba(96, 165, 250, 0.3);
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3),
          0 0 40px rgba(96, 165, 250, 0.1);
        text-align: center;
      }

      .name-modal h2 {
        color: #60a5fa;
        margin-bottom: 20px;
        font-size: 24px;
        text-shadow: 0 0 10px rgba(96, 165, 250, 0.5);
      }

      .name-input {
        width: 100%;
        padding: 15px;
        border: 2px solid rgba(96, 165, 250, 0.3);
        border-radius: 10px;
        background: rgba(255, 255, 255, 0.1);
        color: white;
        font-size: 16px;
        margin-bottom: 20px;
        outline: none;
        transition: all 0.3s ease;
        margin-left: -15px;
      }

      .name-input:focus {
        border-color: #60a5fa;
        box-shadow: 0 0 15px rgba(96, 165, 250, 0.3);
      }

      .name-submit {
        background: linear-gradient(135deg, #60a5fa, #3b82f6);
        border: none;
        color: white;
        padding: 12px 30px;
        border-radius: 25px;
        font-size: 16px;
        cursor: pointer;
        transition: all 0.3s ease;
        box-shadow: 0 4px 15px rgba(96, 165, 250, 0.3);
      }

      .name-submit:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(96, 165, 250, 0.4);
      }

      .toggle {
        position: relative;
        display: inline-block;
        width: 60px;
        height: 30px;
        border-radius: 30px;
        cursor: pointer;
      }

      .toggle-bg {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: #c0e6f6;
        border-radius: 30px;
        border: 2px solid #81c0d5;
        transition: all 0.3s ease;
      }

      .toggle-input {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        z-index: 2;
        opacity: 0;
        cursor: pointer;
      }

      .toggle-switch {
        position: relative;
        width: 24px;
        height: 24px;
        margin: 2px;
        background-color: #f5eb42;
        border: 2px solid #e4c74d;
        border-radius: 50%;
        transition: all 0.3s ease;
      }

      /* Decorative cloud (day) and crater (night) details - scaled for small switch */
      .toggle-switch-figure {
        position: absolute;
        bottom: 2px;
        left: 2px;
        display: block;
        width: 16px;
        height: 8px;
        border-radius: 8px;
        background-color: #fff;
        border: 2px solid #d4d4d2;
        transform: scale(0.8);
        transform-origin: center;
        transition: all 0.12s cubic-bezier(0.25, 0.46, 0.45, 0.94);
      }
      .toggle-switch-figure:before,
      .toggle-switch-figure:after {
        content: "";
        position: absolute;
        background-color: #fff;
        border: 2px solid #d4d4d2;
        border-radius: 100%;
      }
      .toggle-switch-figure:before {
        width: 6px;
        height: 6px;
        top: -4px;
        left: 2px;
      }
      .toggle-switch-figure:after {
        width: 4px;
        height: 4px;
        top: -3px;
        left: 8px;
      }

      .toggle-switch-figureAlt {
        position: absolute;
        top: 6px;
        left: 8px;
        width: 3px;
        height: 3px;
        background-color: #efeeda;
        border-radius: 50%;
        border: 1px solid #dee1c5;
        box-shadow: 6px -1px 0 -0.5px #fcfcfc, 10px -2px 0 -0.5px #fcfcfc,
          8px 1px 0 -1px #fcfcfc;
        transform: scale(0);
        transform-origin: center;
        transition: all 0.12s cubic-bezier(0.25, 0.46, 0.45, 0.94);
      }

      /* When switching to night, hide cloud and reveal moon craters */
      .toggle-input:checked ~ .toggle-switch .toggle-switch-figure {
        opacity: 0;
        transform: scale(0.1);
      }
      .toggle-input:checked ~ .toggle-switch .toggle-switch-figureAlt {
        transform: scale(1);
      }

      /* Checked (Night mode) */
      .toggle-input:checked ~ .toggle-bg {
        background-color: #484848;
        border-color: #202020;
      }
      .toggle-input:checked ~ .toggle-switch {
        margin-left: 32px;
        background-color: #fffdf2;
        border-color: #dee1c5;
      }
    </style>
  </head>
  <body>
    <div id="background">
      <div class="night-sky" id="nightSky" style="display: none">
        <div class="moon" id="moon"></div>
        <div class="cloud cloud1"></div>
        <div class="cloud cloud2"></div>
        <div class="cloud cloud3"></div>
      </div>
      <div class="morning-sky" id="morningSky" style="display: none">
        <div class="sun" id="sun"></div>
        <div class="morning-cloud morning-cloud1"></div>
        <div class="morning-cloud morning-cloud2"></div>
        <div class="morning-cloud morning-cloud3"></div>
      </div>
    </div>

    <div class="nav-bar">
      <div class="status-indicator checking" id="statusIndicator">
        <div class="status-dot"></div>
        <span id="statusText">Checking...</span>
      </div>

      <div
        style="
          position: absolute;
          left: 50%;
          top: 50%;
          transform: translate(-50%, -50%);
          display: flex;
          align-items: center;
        "
      >
        <img
          src="https://raw.githubusercontent.com/yagnarashagan6/Rhyniox-AI/main/Lottie-files/rhynoix.png"
          alt="Rhyniox AI"
          style="
            height: 80px;
            width: 80px;
            vertical-align: middle;
            display: inline-block;
            margin-top: 15px;
          "
        />
        <div
          class="nav-title"
          style="
            font-size: 33px;
            margin-left: -10px;
            display: inline-block;
            vertical-align: middle;
            text-align: left;
          "
        >
          Rhyniox AI
        </div>
      </div>
      <div
        class="theme-wrapper"
        style="
          position: absolute;
          right: 10px;
          top: 50%;
          transform: translateY(-50%);
        "
      >
        <label class="toggle">
          <input class="toggle-input" type="checkbox" id="themeToggle" />
          <div class="toggle-bg"></div>
          <div class="toggle-switch">
            <div class="toggle-switch-figure"></div>
            <div class="toggle-switch-figureAlt"></div>
          </div>
        </label>
      </div>
    </div>

    <div class="main-content">
      <div class="status-display">
        <div class="status-text" id="mainStatusText"></div>
        <div class="typing-dots" id="typingDots">...</div>
      </div>
      <div class="mic-container">
        <button class="mic-button" id="micButton">
          <lottie-player
            id="micAnimation"
            src="https://raw.githubusercontent.com/yagnarashagan6/Rhyniox-AI/main/Lottie-files/Search%20Mic%20wave.json"
            background="transparent"
            speed="1"
            loop
            autoplay
          ></lottie-player>
        </button>
      </div>
    </div>

    <div class="bottom-nav">
      <button class="nav-button" id="historyButton">
        📜
        <span>History</span>
      </button>
      <button class="nav-button" id="modeButton" title="Toggle Mode">
        🔴
        <span>Live</span>
      </button>
      <button class="nav-button" id="voiceButton">
        🗣️
        <span>Voice</span>
      </button>
    </div>

    <div class="modal" id="historyModal">
      <div class="modal-content">
        <div class="modal-header">
          <div class="modal-title">Conversation History</div>
          <button class="close-button" id="closeHistoryModal">✕</button>
        </div>
        <div id="historyContent"></div>
        <div
          class="history-controls"
          style="justify-content: flex-end; margin-top: 15px"
        >
          <button class="control-button danger" id="clearAllHistoryButton">
            Clear All History
          </button>
        </div>
        <div class="history-note">
          Note: History is automatically cleared after 7 days.
        </div>
      </div>
    </div>

    <div class="modal" id="voiceModal">
      <div class="modal-content">
        <div class="modal-header">
          <div class="modal-title">Select a Voice</div>
          <button class="close-button" id="closeVoiceModal">✕</button>
        </div>
        <div id="voiceList" class="voice-list"></div>
      </div>
    </div>

    <div class="name-modal" id="nameModal">
      <div class="name-modal-content">
        <h2>Welcome to Rhyniox AI!</h2>
        <p style="color: #ccc; margin-bottom: 20px">
          Please enter your name to get started:
        </p>
        <input
          type="text"
          class="name-input"
          id="nameInput"
          placeholder="Your name"
          maxlength="50"
        />
        <button class="name-submit" id="nameSubmit">Let's Chat!</button>
      </div>
    </div>

    <script src="https://unpkg.com/@lottiefiles/lottie-player@latest/dist/lottie-player.js"></script>
    <script>
      class JarvisAssistant {
        constructor() {
          this.isListening = false;
          this.isSpeaking = false;
          this.isLiveModeActive = false; // Is continuous listening active
          this.mode = "live"; // 'live' or 'record'
          this.recognition = null;
          this.synthesis = window.speechSynthesis;
          this.selectedVoiceName = this.loadVoicePreference();
          this.voices = [];
          this.userName = this.loadUserName();
          this.backendUrl = "https://rhyniox-ai.onrender.com";
          this.isBackendOnline = false;
          this.statusCheckInterval = null;
          this.hasUserInteracted = false;
          this.pendingWelcomeMessage = null;

          this.initializeElements();
          this.initializeSpeechRecognition();
          this.initializeEventListeners();
          this.initializeTheme();
          this.initializeBackendStatusCheck();
          this.setupUserInteractionHandler();

          this.synthesis.onvoiceschanged = () => this.populateVoiceList();

          if (!this.userName) {
            this.showNameModal();
          } else {
            this.setWelcomeMessage();
          }
        }

        initializeElements() {
          this.micButton = document.getElementById("micButton");
          this.micAnimation = document.getElementById("micAnimation");
          this.statusIndicator = document.getElementById("statusIndicator");
          this.statusTextIndicator = document.getElementById("statusText");
          this.statusElement = document.getElementById("mainStatusText");
          this.typingDots = document.getElementById("typingDots");
          this.historyButton = document.getElementById("historyButton");
          this.modeButton = document.getElementById("modeButton");
          this.voiceButton = document.getElementById("voiceButton");
          this.historyModal = document.getElementById("historyModal");
          this.voiceModal = document.getElementById("voiceModal");
          this.themeToggle = document.getElementById("themeToggle");
          this.nameModal = document.getElementById("nameModal");
          this.nameInput = document.getElementById("nameInput");
          this.nameSubmit = document.getElementById("nameSubmit");
          this.clearAllHistoryButton = document.getElementById(
            "clearAllHistoryButton"
          );

          this.updateStatus(
            this.userName
              ? "Tap the mic to start!"
              : "Welcome! Please enter your name."
          );
        }

        initializeSpeechRecognition() {
          const SpeechRecognition =
            window.SpeechRecognition || window.webkitSpeechRecognition;
          if (!SpeechRecognition) {
            this.updateStatus(
              "Speech recognition not supported by your browser.",
              "error"
            );
            return;
          }
          this.recognition = new SpeechRecognition();
          this.recognition.continuous = true; // Always true to manage restart manually
          this.recognition.interimResults = false; // Only final results
          this.recognition.lang = "en-US";

          this.recognition.onstart = () => {
            this.isListening = true;
            this.micButton.classList.add("listening");
            this.setMicAnimationState("listening");
            if (this.mode === "live" && this.isLiveModeActive) {
              this.updateStatus("Listening continuously...");
            } else {
              this.updateStatus("Listening...");
            }
          };

          this.recognition.onresult = (event) => {
            const transcript =
              event.results[event.results.length - 1][0].transcript.trim();
            if (transcript) {
              if (this.mode === "record") {
                // In record mode, we stop listening on the first final result
                this.stopListening();
              }
              this.handleUserInput(transcript);
            }
          };

          this.recognition.onerror = (event) => {
            console.error("Speech recognition error:", event.error);
            if (event.error === "no-speech") {
              this.updateStatus("Didn’t catch that, please try again.");
            } else if (event.error !== "aborted") {
              this.updateStatus(
                "An error occurred with speech recognition.",
                "error"
              );
            }
            this.stopListening();
          };

          this.recognition.onend = () => {
            this.isListening = false;
            this.micButton.classList.remove("listening");
            this.setMicAnimationState("idle");
            // In live mode, if it's active and we're not speaking, restart listening
            if (
              this.mode === "live" &&
              this.isLiveModeActive &&
              !this.isSpeaking
            ) {
              setTimeout(() => this.startListening(), 300);
            }
          };
        }

        initializeEventListeners() {
          this.micButton.addEventListener("click", () => this.handleMicClick());
          this.historyButton.addEventListener("click", () =>
            this.showHistory()
          );
          this.modeButton.addEventListener("click", () => this.toggleMode());
          this.voiceButton.addEventListener("click", () =>
            this.showVoiceModal()
          );

          document
            .getElementById("closeHistoryModal")
            .addEventListener("click", () => this.hideModal(this.historyModal));
          document
            .getElementById("closeVoiceModal")
            .addEventListener("click", () => this.hideModal(this.voiceModal));
          this.clearAllHistoryButton.addEventListener("click", () =>
            this.clearAllHistory()
          );

          this.initializeNameModal();
          this.themeToggle.addEventListener("change", () =>
            this.updateBackground()
          );

          window.addEventListener("click", (event) => {
            if (event.target === this.historyModal)
              this.hideModal(this.historyModal);
            if (event.target === this.voiceModal)
              this.hideModal(this.voiceModal);
          });
        }

        // --- Core Interaction Logic ---

        handleMicClick() {
          if (this.isSpeaking) {
            this.stopSpeaking();
            return;
          }

          if (this.mode === "live") {
            this.isLiveModeActive = !this.isLiveModeActive; // Toggle live session
            if (this.isLiveModeActive) {
              this.micButton.classList.add("live-mode-active");
              this.startListening();
            } else {
              this.micButton.classList.remove("live-mode-active");
              this.stopListening();
              this.updateStatus("Live mode off. Tap mic to speak.");
            }
          } else {
            // Record mode
            if (this.isListening) {
              this.stopListening();
            } else {
              this.startListening();
            }
          }
        }

        toggleMode() {
          this.stopListening();
          this.isLiveModeActive = false;
          this.micButton.classList.remove("live-mode-active");

          if (this.mode === "live") {
            this.mode = "record";
            this.modeButton.innerHTML = `🎙️ <span>Record</span>`;
            this.updateStatus("Record Mode: Tap and hold mic to speak.");
          } else {
            this.mode = "live";
            this.modeButton.innerHTML = `🔴 <span>Live</span>`;
            this.updateStatus("Live Mode: Tap mic to start continuous chat.");
          }
        }

        startListening() {
          if (this.recognition && !this.isListening && !this.isSpeaking) {
            try {
              this.recognition.start();
            } catch (e) {
              console.error("Error starting recognition:", e);
              this.stopListening(); // Reset state on error
            }
          }
        }

        stopListening() {
          if (this.recognition && this.isListening) {
            this.recognition.stop();
          }
          this.isListening = false;
          this.micButton.classList.remove("listening");
        }

        async handleUserInput(userInput) {
          // Frontend word limit check for live mode
          if (this.mode === "live") {
            const wordCount = userInput.split(/\s+/).filter(Boolean).length;
            if (wordCount > 25) {
              this.updateStatus(
                `That's a bit long for live mode (${wordCount}/25 words). Try record mode.`,
                "warning"
              );
              return;
            }
          }

          this.updateStatus(`You said: "${userInput}"`);
          this.typingDots.style.display = "block";

          try {
            const response = await fetch(`${this.backendUrl}/ask`, {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify({
                text: userInput,
                userName: this.userName,
                mode: this.mode,
              }),
            });

            const data = await response.json();

            if (!response.ok) {
              // Handle 400s (validation) and 429s (rate limit)
              if (response.status === 429) {
                this.updateStatus(data.reply, "warning");
                this.stopListening();
                this.isLiveModeActive = false;
                this.micButton.classList.remove("live-mode-active");
                setTimeout(() => {
                  if (this.mode === "live") {
                    this.updateStatus("Live mode paused. Tap mic to resume.");
                  } else {
                    this.updateStatus("Tap mic to speak again.");
                  }
                }, 3000);
              } else {
                // 400 errors (validation like 'speak clearly')
                this.updateStatus(data.reply, "warning");
              }
              return;
            }

            this.speak(data.reply);
          } catch (error) {
            console.error("Fetch error:", error);
            this.updateStatus(
              "AI is having trouble right now. Please try again later.",
              "error"
            );
          } finally {
            this.typingDots.style.display = "none";
          }
        }

        speak(text) {
          if (!text || !this.hasUserInteracted) {
            if (!this.hasUserInteracted) this.pendingWelcomeMessage = text;
            return;
          }

          this.stopSpeaking();

          const utterance = new SpeechSynthesisUtterance(text);
          const selectedVoice = this.voices.find(
            (v) => v.name === this.selectedVoiceName
          );
          utterance.voice =
            selectedVoice ||
            this.voices.find(
              (v) => v.name.includes("Google") && v.lang.startsWith("en")
            );

          utterance.onstart = () => {
            this.isSpeaking = true;
            this.micButton.classList.add("speaking");
            this.updateStatus("Speaking...");
            this.setMicAnimationState("speaking");
          };

          utterance.onend = () => {
            this.isSpeaking = false;
            this.micButton.classList.remove("speaking");
            this.setMicAnimationState("idle");
            if (this.mode === "live" && this.isLiveModeActive) {
              // Restart is handled by recognition.onend
            } else {
              this.updateStatus("Tap the mic to speak again.");
            }
          };

          this.synthesis.speak(utterance);
        }

        stopSpeaking() {
          if (this.synthesis.speaking) this.synthesis.cancel();
          this.isSpeaking = false;
          this.micButton.classList.remove("speaking");
        }

        // --- UI and State Management ---

        updateStatus(text, type = "info") {
          this.statusElement.textContent = text;
          this.statusElement.className = "status-text"; // Reset class
          if (type === "error") {
            this.statusElement.classList.add("error-text");
          } else if (type === "warning") {
            this.statusElement.classList.add("warning-text");
          }
        }

        setMicAnimationState(state) {
          if (!this.micAnimation) return;
          const speed = { idle: 1, listening: 1.5, speaking: 2 };
          this.micAnimation.setSpeed(speed[state] || 1);
        }

        showModal(modal) {
          modal.style.display = "flex";
        }
        hideModal(modal) {
          modal.style.display = "none";
        }

        async showHistory() {
          const content = document.getElementById("historyContent");
          content.innerHTML = `<div class="empty-history">Loading history...</div>`;
          this.showModal(this.historyModal);

          try {
            const response = await fetch(`${this.backendUrl}/history`);
            if (!response.ok) throw new Error("Failed to fetch history");

            const data = await response.json();

            if (data.history && data.history.length > 0) {
              content.innerHTML = data.history
                .map(
                  (conv) => `
                        <div class="history-item">
                            <div class="history-user">You: ${conv.user}</div>
                            <div class="history-ai">AI: ${conv.ai}</div>
                        </div>`
                )
                .join("");
            } else {
              content.innerHTML = `<div class="empty-history">No conversations yet.</div>`;
            }
          } catch (error) {
            console.error("Error fetching history:", error);
            content.innerHTML = `<div class="empty-history error-text">Could not load history.</div>`;
          }
        }

        async clearAllHistory() {
          if (
            !confirm(
              "Are you sure you want to delete all conversation history from the server?"
            )
          )
            return;
          try {
            const response = await fetch(`${this.backendUrl}/clear-history`);
            if (!response.ok) throw new Error("Failed to clear history");

            this.updateStatus("History cleared successfully.", "info");
            this.hideModal(this.historyModal);
          } catch (error) {
            console.error("Error clearing history:", error);
            alert("Could not clear history. Please try again.");
          }
        }

        showVoiceModal() {
          this.populateVoiceList();
          this.showModal(this.voiceModal);
        }

        populateVoiceList() {
          if (this.synthesis.getVoices().length === 0) return;
          this.voices = this.synthesis
            .getVoices()
            .filter((v) => v.lang.startsWith("en"));
          const voiceList = document.getElementById("voiceList");
          voiceList.innerHTML = this.voices
            .map(
              (voice) => `
            <div class="voice-item ${
              voice.name === this.selectedVoiceName ? "selected" : ""
            }" data-name="${voice.name}">
              <div class="voice-name">${voice.name}</div>
              <div class="voice-lang">${voice.lang}</div>
            </div>`
            )
            .join("");

          voiceList.querySelectorAll(".voice-item").forEach((item) => {
            item.addEventListener("click", () => {
              this.selectedVoiceName = item.dataset.name;
              this.saveVoicePreference(this.selectedVoiceName);
              voiceList
                .querySelector(".selected")
                ?.classList.remove("selected");
              item.classList.add("selected");
              this.speak("I'll use this voice from now on.");
              setTimeout(() => this.hideModal(this.voiceModal), 1500);
            });
          });
        }

        // --- Initialization and Setup ---

        initializeTheme() {
          const isNightTime =
            new Date().getHours() < 6 || new Date().getHours() >= 18;
          this.themeToggle.checked = isNightTime;
          this.updateBackground();
        }

        updateBackground() {
          const isNight = this.themeToggle.checked;
          document.getElementById("nightSky").style.display = isNight
            ? "block"
            : "none";
          document.getElementById("morningSky").style.display = isNight
            ? "none"
            : "block";
          if (!isNight && !document.querySelector("#nightSky .star")) {
            this.createStars();
          }
        }

        createStars() {
          const nightSky = document.getElementById("nightSky");
          if (nightSky.querySelector(".star")) return; // Don't create if they exist
          const starSizes = ["small", "medium", "large"];
          for (let i = 0; i < 50; i++) {
            const star = document.createElement("div");
            star.className = `star ${starSizes[Math.floor(Math.random() * 3)]}`;
            star.style.left = `${Math.random() * 100}%`;
            star.style.top = `${Math.random() * 100}%`;
            star.style.animationDelay = `${Math.random() * 3}s`;
            nightSky.appendChild(star);
          }
        }

        initializeBackendStatusCheck() {
          const checkStatus = async () => {
            try {
              this.updateStatusIndicator("checking", "Checking...");
              const response = await fetch(`${this.backendUrl}/health`);
              if (response.ok) {
                this.isBackendOnline = true;
                this.updateStatusIndicator("online", "Live");
              } else {
                throw new Error("Backend not healthy");
              }
            } catch (error) {
              this.isBackendOnline = false;
              this.updateStatusIndicator("offline", "Offline");
            }
          };
          checkStatus();
          this.statusCheckInterval = setInterval(checkStatus, 30000);
        }

        updateStatusIndicator(status, text) {
          this.statusIndicator.className = `status-indicator ${status}`;
          this.statusTextIndicator.textContent = text;
        }

        setupUserInteractionHandler() {
          const enableAudio = () => {
            if (!this.hasUserInteracted) {
              this.hasUserInteracted = true;
              this.synthesis?.cancel(); // Initialize synthesis
              if (this.pendingWelcomeMessage) {
                this.updateStatus(
                  this.pendingWelcomeMessage.replace(
                    " (Click anywhere to enable voice)",
                    ""
                  )
                );
                this.speak(this.pendingWelcomeMessage);
                this.pendingWelcomeMessage = null;
              }
              document.removeEventListener("click", enableAudio);
              document.removeEventListener("keydown", enableAudio);
            }
          };
          document.addEventListener("click", enableAudio);
          document.addEventListener("keydown", enableAudio);
        }

        loadVoicePreference() {
          return localStorage.getItem("jarvis-voice") || "";
        }
        saveVoicePreference(voiceName) {
          localStorage.setItem("jarvis-voice", voiceName);
        }
        loadUserName() {
          return localStorage.getItem("jarvis-user-name") || "";
        }
        saveUserName(name) {
          localStorage.setItem("jarvis-user-name", name);
          this.userName = name;
        }

        showNameModal() {
          this.nameModal.style.display = "flex";
          this.nameInput.focus();
        }

        setWelcomeMessage() {
          const welcomeMessage = `Hello ${this.userName}! How can I help you today?`;
          this.updateStatus(
            welcomeMessage + " (Click anywhere to enable voice)"
          );
          this.pendingWelcomeMessage = welcomeMessage;
          if (this.hasUserInteracted) {
            setTimeout(() => this.speak(welcomeMessage), 1500);
          }
        }

        initializeNameModal() {
          const submit = () => {
            const name = this.nameInput.value.trim();
            if (name) {
              this.saveUserName(name);
              this.nameModal.style.display = "none";
              this.setWelcomeMessage();
            }
          };
          this.nameSubmit.addEventListener("click", submit);
          this.nameInput.addEventListener("keypress", (e) => {
            if (e.key === "Enter") submit();
          });
        }
      }

      window.addEventListener("load", () => new JarvisAssistant());
    </script>
  </body>
</html>
